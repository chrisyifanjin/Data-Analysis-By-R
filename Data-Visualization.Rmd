---
title: "Data Visualisation"
author: "Yifan Jin"
date: "05/02/2020"
output:
  pdf_document: default
  html_document: default
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```

# Introduction

## Prerequisites

```{r, warning=FALSE}
library(tidyverse)
```

We can employ function by using `package::function()` eg. `ggplot2::ggplot()` or directly using function eg. `ggplot()`

## First steps
Think about the relationship between variables, think about the mean of one group is smaller or greater than other, think about one variable is positively or negatively correlated with other.

### Example: The data frame `mpg`  
```{r}
mpg
```

Variables descriptions:

1. `displ`, a car's engine size, in litres

2. `hwy`, a car's fuel efficiency on the highway, in miles per gallon (mpg). A car with low fuel efficiency consumes more fuel than a car with a high fuel efficiency when they travel the same distance

To learn more information about `mpg`, use `?mpg` to get more.

### Creating a ggplot

```{r}
ggplot(data=mpg)+
  geom_point(mapping=aes(x=displ,y=hwy))
```

We can see that there is a negative relationship between engine size (`displ`) and fuel efficiency (`hwy`). We can form a hypothesis test to formally test the relationship.

### A graphing template
```{r}
# ggplot(data = <DATA>) + 
#  <GEOM_FUNCTION>(mapping = #    aes(<MAPPINGS>))
```

### Exercise

**1. Run `ggplot(data=mpg)`. What do you see?**

```{r}
ggplot(data=mpg)
```

**Answer:**
We get nothing

**2. How many rows are in `mpg`? How many columns**

```{r}
str(mpg)
```

**Answer:**

We have `234` rows of observations and 11 variables

**3. What does the `drv` variable describe? Read the help for out**

```{r}
?mpg
```

`drv:` f = front-wheel drive, r = rear wheel drive, 4 = 4wd

**4. Make a scatterplot of `hwy` vs `cyl`**

**Answer:**

```{r}
ggplot(data=mpg)+geom_point(mapping = aes(x=hwy,y=cyl))
```

**5. What happens if you make scatterplot of `class` vs `drv`? Why is not useful?**

**Answer:**

It can be seen that `cyl` only take certain values which is discrete variable. Therefore, it looks strange. We can not see any information about the realtionship between two variables, hence, it doesn't make much sense.

## Aesthetic mappings

*The greatest value of a picture is when it forces us to notice what we never expected to see*

```{r}
ggplot(data=mpg)+
  geom_point(mapping=aes(x=displ,y=hwy))
```

There are some points on the right which is outside the general trend. There may be other factors that affect hwy.
 
We can add `class` variable 

```{r}
ggplot(data=mpg)+
  geom_point(mapping=aes(x=displ,y=hwy,color=class))
```

The colors reveal that many of the unusual points are two-seater cars.

Not only the color can be used for categorical variable, but also the size.

```{r}
ggplot(data=mpg)+
  geom_point(mapping=aes(x=displ,y=hwy,size=class))
```

We could also mapped `class` to the alpha aesthetic, which controls the transparency of the points, or to the shape aesthetic, which controls the shape of the points.

```{r}

ggplot(data=mpg)+
  geom_point(mapping=aes(x=displ,y=hwy,alpha=class))

ggplot(data=mpg)+
  geom_point(mapping=aes(x=displ,y=hwy,shape=class))
```

However, for shape method, maximum shape in a graph is 6, there are seven. the additional groups are unplotted.
 
We also can directly add color to the plot.
```{r}
ggplot(data=mpg)+
  geom_point(mapping=aes(x=displ,y=hwy),color="blue")
```

### Exercise

**1. What is gone wrong with this code? Why are the points not blue?**
```{r}
ggplot(data=mpg)+
  geom_point(mapping=aes(x=displ,y=hwy,color="blue"))
```

**Answer** 

It shouldn't inside the aes bracket.

**2. Which variables in `mpg` are categorical? Which variables are continuous? use`?mpg`how can you see this information when you run `mpg`**

```{r}
mpg
```

We can see this by seeing data structure

**3. Map a continuous variable to `color`, `size`, and `shape`. How do these aesthetics behave differently for categorical vs. continuous variables?**

**Answer**
Nothing

**4. What happens if you map the same variable to multiple aesthetics**

```{r}
ggplot(data=mpg)+geom_point(aes(x=cty,y=cty),stroke=1)
```

**Answer**
It will form a 45 degree line.


**6. What happens if you map an aesthetic to something other than a variable name, like aes(colour = displ < 5)? Note, youâ€™ll also need to specify x and y.**

```{r}
ggplot(data=mpg)+geom_point(aes(x=cty,y=hwy,color=displ<5))
```

**Answer**

It distinguishs data point with the displ with <5 and >5.

## Common problems

Remember to use pairness and put everything on th right position.

## Facets
Facets is particularly useful for categorical variables, is to split your plot into facets.

`facet_wrap`: first argument is `~`, which is followed by a variable name. the variable you pass to `facet_wrap` must be discrete

```{r}
ggplot(data=mpg)+
  geom_point(mapping = aes(x=displ,y=hwy))+
  facet_wrap(~cyl,nrow=2)
```

`facet_grid()`  is contain two discrete variables ~
```{r}
ggplot(data=mpg)+
  geom_point(mapping=aes(x=displ,y=hwy))+
  facet_grid(drv~cyl)
```

If you prefer to not facet in the rows or columns dimension.
```{r}
ggplot(data=mpg)+
  geom_point(mapping=aes(x=displ,y=hwy))+
  facet_grid(.~cyl)
```

### Exercises

```{r}
ggplot(data=mpg)+
  geom_point(mapping=aes(x=displ,y=hwy))+
  facet_grid(.~displ)
```

It actually will generate each category for each number of continuous variable

## Geometric objects

*Geom*

```{r}
ggplot(data=mpg)+
  geom_point(mapping=aes(x=displ,y=hwy))
```

```{r}
ggplot(data=mpg)+
  geom_smooth(mapping = aes(x=displ,y=hwy))
```

Every geom function in ggplot2 takes a `mapping` argument. However, not every aesthetic works with every geom.You could set shape of the points but not shape of the line. On the other hand, you could set the linetype of a line. `geom_smooth()` will draw a different line, with different linetype.

```{r}
ggplot(data=mpg)+
  geom_smooth(mapping=aes(x=displ,y=hwy,linetype=drv))
```

It separates the cars into three lines based on their `drv` value, which describes a car's drivetrain.

```{r}
ggplot(data = mpg) +
  geom_smooth(mapping = aes(x = displ, y = hwy))
              
ggplot(data = mpg) +
  geom_smooth(mapping = aes(x = displ, y = hwy, group = drv))
    
ggplot(data = mpg) +
  geom_smooth(
    mapping = aes(x = displ, y = hwy, color = drv),
    show.legend = FALSE
  )
```

To display multiple geoms in the same plot, add multiple geom functions to `ggplot()`:

```{r}
ggplot(data=mpg)+
  geom_point(mapping=aes(x=displ,y=hwy))+
  geom_smooth(mapping=aes(x=displ,y=hwy))
```

Or equivalently,

```{r}
ggplot(data=mpg,mapping=aes(x=displ,y=hwy))+
  geom_point()+
  geom_smooth()
```

We can also add the color
```{r}
ggplot(data=mpg,mapping=aes(x=displ,y=hwy))+
  geom_point(mapping = aes(color=class))+
  geom_smooth()
```

```{r}
ggplot(data=mpg,mapping=aes(x=displ,y=hwy))+
  geom_point(mapping=aes(color=class))+
  geom_smooth(data=filter(mpg,class=="subcompact"),se=FALSE)
```

Just plot the data which class=cubcompact

### Exercises

**1. What geom would you use to draw a line chart? A boxplot? A histogram? An area chart?**

**Answer**

geom_line(), geom_box(), geom_histogram()

**2. Running this code predict what the output will look like. Then, run the code in R and check your predictions**

```{r}
ggplot(data = mpg, mapping = aes(x = displ, y = hwy, color = drv)) + 
  geom_point() + 
  geom_smooth(se =F)
```

**Answer**

se=false means no shaded areas.

**3. What does `show.legend=FALSE` do? What happens if you remove it? Why do you think I used it ealier in the chapter?**

**Answer**

It means the graph do not show the upper right corner of the tag.

**4. Will these graphs look different? Why/why not?**

```{r}
ggplot(data = mpg, mapping = aes(x = displ, y = hwy)) + 
  geom_point() + 
  geom_smooth()

ggplot() + 
  geom_point(data = mpg, mapping = aes(x = displ, y = hwy)) + 
  geom_smooth(data = mpg, mapping = aes(x = displ, y = hwy))
```

**Answer**

Nothing is different. Since it is same to put different positions.

**6. Recreate the R code necessary to generate the following grpahs.**

```{r}
ggplot(data=mpg,mapping = aes(x=displ,y=hwy))+
  geom_point()+
  geom_smooth(se=F)
```

```{r}
ggplot(data=mpg,mapping=aes(x=displ,y=hwy,group=drv))+
  geom_point()+
  geom_smooth(se=F)
```

```{r}
ggplot(data=mpg,mapping=aes(x=displ,y=hwy))+
  geom_point(mapping = aes(color=drv))+
  geom_smooth(se=F,mapping=aes(color=drv))
```
```{r}
ggplot(data=mpg,mapping=aes(x=displ,y=hwy))+
  geom_point(mapping = aes(color=drv))+
  geom_smooth(se=F)
```

```{r}
ggplot(data=mpg,mapping=aes(x=displ,y=hwy,linetype=drv))+
  geom_point(mapping = aes(color=drv))+
  geom_smooth(se=F)
```

```{r}
ggplot(data=mpg,mapping=aes(x=displ,y=hwy))+
  geom_point(mapping = aes(color=drv,stroke=1))
```

## Statistical transformations






